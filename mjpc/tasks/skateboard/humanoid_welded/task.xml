<mujoco model="Welded Skateboard">
  <include file="../../common.xml"/>
  <include file="./humanoid.xml" />
  <include file="../skateboard.xml" />
  <size memory="800K"/>

   <custom>
    <numeric name="agent_planner" data="3" />
    <numeric name="agent_horizon" data="0.35" />
    <numeric name="agent_timestep" data="0.015" />
    <numeric name="sampling_spline_points" data="6" />
    <numeric name="sampling_exploration" data="0.05" />
    <numeric name="residual_Height Goal" data="1.35 0.0 1.7" />
    <numeric name="residual_Velocity" data="0 -5 5" />
    <numeric name="residual_Tilt angle" data="0 -0.26 0.26" />
    <numeric name="residual_rFeet pos" data="0 0 1.0" />
    <numeric name="residual_LFeet pos" data="0 0 1.0" />
    <numeric name="residual_rFeet orientation" data="0 -1.56 1.56" />
    <numeric name="ilqg_num_rollouts" data="8" />
    <numeric name="ilqg_regularization_type" data="1" />
    <numeric name="ilqg_representation" data="2" />
  </custom>

  <worldbody>
    <camera name="side-far" mode="trackcom" pos="-3.794 -2.634 2.085" xyaxes="0.536 -0.844 0.000 0.294 0.187 0.937"/>
    <camera name="close" mode="trackcom"  pos="-1.695 -1.870 1.312" xyaxes="0.702 -0.713 -0.000 0.261 0.257 0.930"/>
    <camera name="top" mode="trackcom" pos="-0.405 -1.688 20.714" xyaxes="-0.008 -1.000 0.000 1.000 -0.008 0.017"/>
    <body name="goal" mocap="true" pos=".3 20 0.26">
      <geom size="0.15" contype="0" conaffinity="0" rgba="1 0 0 1" group="2"/>
    </body>
  </worldbody>

  <sensor>
    <user name="Velocity" dim="1" user="0 0 0.0 100.0" />
    <user name="Goal Position" dim="3" user="6 0 0.0 100.0 0.1" />
    <user name="Goal Orientation" dim="1" user="0 0 0 100.0" />
    <user name="Height" dim="1" user="6 80.0 0.0 100.0 0.1" />
    <!-- <user name="Upright" dim="8" user="6 50.0 0.0 100.0 0.1" /> -->
    <user name="Balance" dim="2" user="6 50.0 0.0 100.0 0.1" />
    <user name="Upright" dim="8" user="2 5.0 0.0 25.0 0.01" />
    <user name="CoM Vel." dim="2" user="6 50.0 0.0 100.0 0.1" />
    <user name="Right Foot on Board" dim="1" user="6 40 0.0 100.0 0.1" />
    <user name="Left Foot on Board" dim="1" user="6 40 0.0 100.0 0.1" />
    <user name="Tilt angle" dim="1" user="0 0 0 100.0" />
    <user name="rFeet orientation" dim="1" user="0 0 0 100.0" />

    <user name="Joint Vel." dim="22" user="0 0.01 0.0 0.1" />
    <user name="Control" dim="21" user="3 0.025 0.0 0.1 0.3" />


    <framepos name="trace0" objtype="body" objname="board_center"/>
    <!-- <framepos name="trace1" objtype="body" objname="foot_left"/> -->
    <!-- <framepos name="trace2" objtype="body" objname="foot_right"/> -->
    <!-- <framepos name="trace1" objtype="body" objname="board_center"/> -->
    <framepos name="torso_position" objtype="body" objname="torso"/>
    <framepos name="head_position" objtype="body" objname="head"/>
    <framequat name="head_orientation" objtype="body" objname="head"/>
    <framezaxis name="torso_zaxis" objtype="body" objname="torso"/>
    <framelinvel name="torso_subtreelinvel" objtype="body" objname="torso" />
    <subtreecom name="torso_subtreecom" body="torso"/>
    <framexaxis name="torso_forward" objtype="body" objname="torso" />

    <framepos name="sp0" objtype="site" objname="sp0"/>
    <framepos name="sp1" objtype="site" objname="sp1"/>
    <framepos name="sp2" objtype="site" objname="sp2"/>
    <framepos name="sp3" objtype="site" objname="sp3"/>
    <framepos name="tracking_foot_left" objtype="site" objname="tracking[ltoe]"/>
    <framepos name="tracking_foot_right" objtype="site" objname="tracking[rtoe]"/>

    <framezaxis name="torso_up" objtype="xbody" objname="torso"/>
    <framezaxis name="pelvis_up" objtype="xbody" objname="pelvis"/>
 

    <framezaxis name="foot_right_up" objtype="xbody" objname="foot_right"/>
    <framezaxis name="foot_left_up" objtype="xbody" objname="foot_left"/>

    <framepos name="track-back-plate" objtype="site" objname="track-back-plate"/>
    <framepos name="track-front-plate" objtype="site" objname="track-front-plate"/>

    <subtreelinvel name="foot_right_vel" body="foot_right"/>
    <subtreelinvel name="foot_left_vel" body="foot_left"/>
    <framelinvel name="skateboard_framelinvel" objtype="body" objname="skateboard"/>
  </sensor>

  <keyframe>
  <!--  PUSH INIT
    <key qpos='-0.580893 -0.380911 1.18326 0.473358 -0.0984097 0.130169 0.865624 0.297602 -0.974663 -0.0179795 -0.514885 -0.132614 0.346061 -1.21863 -0.760553 -0.704605 -0.16429 -0.638325 0.352434 -0.651989 0.348715 -0.811043 1.00825 0.791914 -1.73602 0.218656 0.0649717 -1.43441 -0.557197 -0.355524 0.0985215 -0.720079 8.67539e-05 -4.21686e-05 -0.693892 0.0218445 0.0194171 -88.5227 -88.5638 0.0165476 -88.4953 -88.5503'/>
  -->
  <!-- <key qpos='-0.346285 1.58886 1.30323 0.0875386 -0.138341 0.0797165 0.983282 -0.560394 -0.627535 0.023249 -0.0599903 -0.111583 -0.228211 -0.746062 -0.155623 0.149264 0.179301 0.541888 0.286944 -0.705611 -0.602122 -0.206549 0.48941 0.135232 -1.75036 0.545177 0.254236 -1.6021 -0.346531 1.63963 0.0985581 -0.690693 0.00026086 0.000693116 -0.723147 0.041312 0.0242612 -36.7335 -36.7295 0.0243332 -36.7253 -36.7376'
  qvel="0 5 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 0 0 0 0 0 0 0 0 0 0 0"/> -->
  
  <!-- <key name="home"  qpos='-0.525946 -0.36578 1.09431 0.337874 -0.134928 0.205427 0.908535 -0.424578 -0.16616 -0.495801 -0.468328 0.569092 -1.67877 -1.20059 -0.434139 0.306221 0.00660043 -0.883754 -1.32983 -1.83521 -1.04158 -0.184538 0.146789 -0.429759 -0.396783 0.950078 0.0303084 -1.71569 -0.538169 -0.366389 0.0992553 -0.716109 -0.00195445 0.0019973 -0.697983 -0.0288003 -0.0193057 -88.8849 -88.919 -0.0194575 -88.7806 -88.851' -->
  <!-- <key name="home" qpos='-0.555426 -0.219 1.22044 -0.297764 -0.0584369 0.0175305 0.952688 -0.0488657 -0.0849685 -0.0672107 -0.180577 -0.0684978 -0.500971 -1.3237 -0.834365 0.100182 0.18035 -0.473653 -0.802263 -0.721021 -0.611642 -1.27806 0.883046 -1.4797 -1.54119 1.04578 -1.33641 -1.61039 -0.50469 -0.206957 0.0981171 -0.487001 -0.00019987 0.000307008 -0.873402 0.0175939 0.0232693 -87.6221 -87.7715 0.020552 -87.7794 -87.5581' -->
  
  <!-- STEERING INIT UPRIGHT -->
  <key qpos='-0.573982 -0.299261 1.29233 0.251367 -0.0291265 -0.0342376 0.966847 0.382875 -0.172686 0.0927326 -0.163909 0.108965 -0.372 -1.01319 -0.553034 -0.0217802 -0.142264 -0.128344 -0.268712 -0.959531 -0.612709 -0.0190043 0.442296 -0.355829 -0.879035 0.442835 -0.340153 -0.878581 -0.620308 -0.293388 0.0981391 -0.692177 -0.000273943 -0.000359778 -0.721728 -0.0234655 -0.0085077 -91.7841 -91.9101 -0.0112929 -91.8944 -91.6997'
  qvel="0 5 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 5 0 0 0 0 0 0 0 0 0 0 0"/>
  <!-- STEERING CROUCHED -->
  <key  name="home"  qpos='-0.547237 2.74946 1.1184 0.246216 -0.0070318 0.014602 0.969079 0.424478 -0.122253 -0.0223737 -0.201387 0.0495389 -0.775815 -1.82689 -0.847576 -0.0112933 -0.207129 0.14605 -0.878254 -1.73656 -0.783102 0.0637319 0.440873 -0.261809 -0.887634 0.37788 -0.348261 -0.886485 -0.632345 2.73402 0.098652 -0.748837 -4.20786e-05 0.000468588 -0.662755 -0.00576789 0.00552895 -7.94193 -7.99952 -0.0237845 -7.67586 -8.37805'
  qvel="0 5 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 4.5 0 0 0 0 0 0 0 0 0 0 0"/>
  <!-- PUSHING INIT -->
  <!-- <key name="home" qpos='-0.704934 -0.271105 1.17139 0.601998 0.0285527 -0.0176907 0.797791 -0.290037 0.0614182 -0.071186 0.166288 0.0842589 -0.598809 -1.50382 -0.876758 -0.182495 -0.268364 -0.183978 -0.353662 -1.07908 -0.631876 1.23081 0.970828 -0.664467 -1.75432 1.05474 -0.663433 -1.75382 -0.675349 -0.267592 0.0983024 -0.711107 0.000421966 0.000333692 -0.703084 0.0446937 0.0220051 -93.2538 -93.1654 0.0223697 -93.1169 -93.3272'
  qvel="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0"/> -->
  
  </keyframe>
  <equality>
    <!-- PUSHING WELD -->
    <!-- <weld body1="foot_right" body2="board_center" relpose="0.05 0 0 -1 0 0 0" torquescale="0.1"/>
    <weld body1="pelvis" body2="skateboard" relpose="-0.1 0 -0.60 -1 0 0 0" torquescale="0.003"/> -->
    
    <!-- STEERING WELD -->
    <weld body1="foot_right" body2="board_center" relpose="0.05 0.2 0 1 0 0 -1" torquescale="0.01"/>
    <weld body1="foot_left" body2="board_center" relpose="0 -0.2 0 1 0 0 -1" torquescale="0.01"/>
    <!-- <weld body1="head" body2="skateboard" relpose="0 0 -1.3 1 0 0 -1" torquescale="0.001"/> -->
    <!-- <weld body1="pelvis" body2="skateboard" relpose="0.05 0 -0.7 1 0 0 -1" torquescale="0.05"/> -->
    <!-- <weld body1="head" body2="board_center" relpose="0 0 -1.3 1 0 0 -1" torquescale="0.05"/> -->
    
    
    <weld body1="pelvis" body2="board_center" relpose="0 0 -0.6 1 0 0 -1" torquescale="0.005"/>
    <!-- <joint joint1="abdomen_y" joint2="board-tilt" polycoef="0 -4 0 0 0"/> -->
  </equality>
  <contact>
    <exclude body1="foot_right" body2="wheel-front-left"/>
    <exclude body1="foot_right" body2="wheel-front-right"/>
    <exclude body1="foot_left" body2="wheel-back-left"/>
    <exclude body1="foot_left" body2="wheel-back-right"/>
    <exclude body1="foot_left" body2="bushings-and-hanger-back"/>
    <exclude body1="foot_left" body2="baseplate-back"/>
    <exclude body1="shin_left" body2="wheel-back-left"/>
    <exclude body1="shin_left" body2="wheel-back-right"/>
    <exclude body1="shin_left" body2="bushings-and-hanger-back"/>
    <exclude body1="shin_left" body2="baseplate-back"/>
  </contact>
</mujoco>
